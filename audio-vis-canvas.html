<html>
<head>
    <style type="text/css">
        * {
            border: 0;
            margin: 0;
            padding: 0;
        }
        
        .bar {
            display: block;
            height: calc(100% / 255);
            width: 100%;
            background-color: red;
        }
        
        .dd-hover {
            background-color: yellow;
        }
       
        #viz-canvas {
            width: 100%;
            height: 100%;
            position: fixed;
            z-index: 1;
        }
        
        #src-input {
            display: none;
        }
        
        #select-audio {
            position: fixed;
            right: 50px;
            font-family: Arial, sans-serif;
            padding: 6px;
            background-color: rgba(255, 0, 0, 0.50);
            color: #fff;
            cursor: pointer;
            z-index: 10;
            transition: all 0.2s;
            font-size: 10px;
        }
        
        #select-audio:hover {
            background-color: rgba(255, 0, 0, 1.0);
        }
    </style>

    <script type="text/javascript">
        var renderFrame, barH, canvas, canvasCtx;
    
        window.onload = function() {
            var ctx = new AudioContext();
            var audio = document.getElementById('audio');
            var audioSrc = ctx.createMediaElementSource(audio);
            var analyser = ctx.createAnalyser();
            
            canvas = document.getElementById('viz-canvas');
            canvasCtx = canvas.getContext('2d');
            
            // we have to connect the MediaElementSource with the analyser 
            audioSrc.connect(analyser);
            // then connect it to the audio destination
            audioSrc.connect(ctx.destination);
            
            // we could configure the analyser: e.g. analyser.fftSize (for further infos read the spec)

            // frequencyBinCount tells you how many values you'll receive from the analyser
            var frequencyData = new Uint8Array(analyser.frequencyBinCount);

            // we're ready to receive some data!
            // loop
            renderFrame = function () {
                requestAnimationFrame(renderFrame);
                // update data in frequencyData
                analyser.getByteFrequencyData(frequencyData);
                // render frame based on values in frequencyData
                // canvas drawing
                canvasCtx.clearRect(0, 0, canvas.width, canvas.height);
                for (var i = 0; i < 256; i++) {
                    canvasCtx.fillStyle = 'rgb('+i+', '+(255 - i)+', 255)';
                    canvasCtx.fillRect(0, i * barH, window.innerWidth * (frequencyData[i]/255), barH);
                }
            }  
            
            // attaches drag/drop event to body (for changing src via drag/drop)
            function attachDragDropEventListeners() {
                var holder = document.getElementsByTagName('body')[0];
                var audio = document.getElementById('audio');
                
                holder.ondragover = function () { this.className = 'dd-hover'; return false; };
                holder.ondragend = function () { this.className = ''; return false; };
                holder.ondrop = function (e) {
                    this.className = '';
                    e.preventDefault();

                    var file = e.dataTransfer.files[0],
                        reader = new FileReader();
                        
                    reader.onload = function (event) {                       
                        audio.src = event.target.result;
                        
                        // restart the analyser and sound src
                        audio.play();
                    };
                    
                    reader.readAsDataURL(file);

                    return false;
                };
            }
            
            resizeCanvas();
            attachDragDropEventListeners()
            audio.play();
            renderFrame();
        };
        
        window.onresize = function () {
            resizeCanvas();
        };
        
        // resize canvas
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            barH = canvas.height / 255;
        }
        
        // change the media source via file select
        function changeMediaSrc() {
            var audio = document.getElementById('audio');
        
            // stop the current media src
            audio.pause();
            
            // replace the src
            var reader = new FileReader();

            reader.onload = function (event) {
                audio.src = event.target.result;
                
                // restart the analyser and sound src
                audio.play();
            };
            reader.readAsDataURL(document.getElementById("src-input").files[0]);
        }
    </script>
</head>

<body>
    <span id="select-audio" onclick="document.getElementById('src-input').click()">SELECT AUDIO</span>
    <input id="src-input" type="file" onchange="changeMediaSrc()" />
    <audio id="audio" src="dorchadas.mp3"></audio>
    <canvas id="viz-canvas"></canvas>
</body>
</html>